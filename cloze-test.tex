% https://tug.org/TUGboat/tb32-1/tb100isambert.pdf
\directlua{
   cloze_test = require('cloze-test')
   cloze_test.register_functions()
}

\newif\ifPLAINLUATEX

\directlua{
  cloze_test.set_if_plain_luatex()
}

\input cloze.tex

\ifPLAINLUATEX
  \def\createcatcodes{
    \bgroup
      \catcode`\\=12
      \catcode`\{=12
      \catcode`\}=12
      \catcode`\$=12
      \catcode`\&=12
      \catcode`\^^M=13
      \catcode`\#=12
      \catcode`\^=12
      \catcode`\_=12
      \catcode`\ =13
      \catcode`\~=12
      \catcode`\%=12
      \savecatcodetable 1
    \egroup
  }
  \createcatcodes

  \def\Space{ }
  \bgroup
    \catcode`\^^M=13\gdef^^M{\quitvmode\par}%
    \catcode`\ = 13\gdef {\quitvmode\Space}%
  \egroup
\else
\fi

\def\EndClozeTest{}

\def\ClozeTestUseLast{
   \directlua{cloze_test.use_last()}
}

\def\ClozeTestLastVerbatim{
  \directlua{
    cloze_test.print_last_verbatim()
  }
}

\def\ClozeTestAll{%
  \directlua{
    cloze_test.print_all()
  }%
}
