% https://tug.org/TUGboat/tb32-1/tb100isambert.pdf
\directlua{
   cloze_test = require('cloze-test')
   cloze_test.register_functions()
}

\input cloze.tex

\def\createcatcodes{
  \bgroup
    \catcode`\\=12
    \catcode`\{=12
    \catcode`\}=12
    \catcode`\$=12
    \catcode`\&=12
    \catcode`\^^M=13
    \catcode`\#=12
    \catcode`\^=12
    \catcode`\_=12
    \catcode`\ =13
    \catcode`\~=12
    \catcode`\%=12
    \savecatcodetable 1
  \egroup
}
\createcatcodes

\def\Space{ }
\bgroup
  \catcode`\^^M=13\gdef^^M{\quitvmode\par}%
  \catcode`\ = 13\gdef {\quitvmode\Space}%
\egroup

\def\EndClozeTest{}

\def\useverbatim{%
   \directlua{cloze_test.print_lines()}%
}

\def\printverbatim{%
   \bgroup\parindent=0pt \tt
   \directlua{cloze_test.print_lines(1)}
   \egroup
}

\def\ClozeTestAll{%
  \directlua{
    cloze_test.test_all()
  }%
}
